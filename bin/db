#!/usr/bin/env bash
set -e

cd $(dirname "$0")/..

bin/container ensure
source dev-env

if [ "$1" == "console" ]; then
  psql

elif  [ "$1" == "migrate" ]; then
  cargo run -- db migrate

elif  [ "$1" == "prepare" ]; then
  SHP_NAME=simplified-land-polygons-complete
  SRID=3857

  # source: https://wiki.openstreetmap.org/wiki/Coastline
  wget "https://osmdata.openstreetmap.de/download/$SHP_NAME-$SRID.zip" -O "/tmp/$SHP_NAME.zip"
  unzip -o "/tmp/$SHP_NAME.zip" -d /tmp
  shp2pgsql -I -s "$SRID" "/tmp/$SHP_NAME-$SRID/simplified_land_polygons.shp" "$SHP_NAME" | psql
  
else
  echo "Usage: $0 console|migrate"
  exit 1

fi


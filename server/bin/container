#!/usr/bin/env bash
set -e

cd $(dirname "$0")/../..

case "$1" in
  up)
    echo "Starting containers..."
    docker compose up -d minio
    echo "Initializing MinIO bucket..."
    docker compose up minio-init
    echo "Containers are ready."
    echo ""
    echo "Start server with:   cd server && ./bin/dev-server"
    echo ""
    echo "MinIO Console: http://localhost:9001 (rewind/rewindpass)"
    echo "S3 Endpoint:   http://localhost:9000"
    ;;

  down)
    echo "Stopping containers..."
    docker compose down
    ;;

  logs)
    docker compose logs -f "${@:2}"
    ;;

  destroy)
    echo "Destroying containers and volumes..."
    docker compose down -v
    ;;

  minio)
    echo "Opening MinIO Console..."
    open http://localhost:9001 2>/dev/null || xdg-open http://localhost:9001 2>/dev/null || echo "Visit http://localhost:9001"
    ;;

  *)
    echo "Usage: $0 {up|down|logs|minio|destroy}"
    echo ""
    echo "Commands:"
    echo "  up       Start minio container"
    echo "  down     Stop all containers"
    echo "  logs     Follow container logs (optionally specify service)"
    echo "  minio    Open MinIO console in browser"
    echo "  destroy  Stop containers and remove volumes"
    exit 1
    ;;
esac
